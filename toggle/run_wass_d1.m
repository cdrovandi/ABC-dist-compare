function run_wass_d1

% run abc with Wass distance for dataset 1

load('d1.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw([320 0.25 0.15 25 4 15 4]);
    dist(i) = Wass_stat_M(x,y,1);
end

eps = quantile(dist, 0.01);
%eps = 2.16793518151315;

start = [320 0.25 0.15 25 4 15 4];

cov_rw = [0.00790990170905741,-0.000598654576580869,0.00293220547672884,-0.00134931281884978,0.0140399113537943,-0.0204343196963424,-0.00177319847075653;-0.000598654576580869,0.00701024083510214,0.00964688321720585,0.000144045799753269,-0.000235990076146359,0.0146351521238147,-0.00125348394877765;0.00293220547672884,0.00964688321720585,0.0220568767432531,-0.000447935379540184,0.0138382955565171,-0.00277915453991483,-0.00570263189568827;-0.00134931281884978,0.000144045799753269,-0.000447935379540184,0.000264984231941320,-0.000385994133460632,0.00194949611672777,0.00160696873962017;0.0140399113537943,-0.000235990076146359,0.0138382955565171,-0.000385994133460632,0.967948422089214,-1.10451954637150,0.476463180903373;-0.0204343196963424,0.0146351521238147,-0.00277915453991483,0.00194949611672777,-1.10451954637150,3.59649777570013,0.189599075332496;-0.00177319847075653,-0.00125348394877765,-0.00570263189568827,0.00160696873962017,0.476463180903373,0.189599075332496,1.48351796192090];

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_wass(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_wass.mat','theta','dist','eps');


end
