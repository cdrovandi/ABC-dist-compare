function run_cvm_d1

% run abc with CvM distance for dataset 1

load('d1.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw([320 0.25 0.15 25 4 15 4]);
    dist(i) = cvm_stat_M(x,y,2);
end

eps = quantile(dist, 0.01);
%eps = 32.6149999999984;

cov_rw = [0.0114656878544502,0.00145891624159205,0.00851909154662195,-0.00186763463080292,0.00234266702275449,0.00698148233960845,0.000767642710567363;0.00145891624159205,0.0161003956106131,0.0203121628876752,1.85273807520757e-06,-0.00997433986762452,0.00287528057223428,-0.00543126118860652;0.00851909154662195,0.0203121628876752,0.0362900490261667,-0.00101002532952898,-0.00700992815168033,0.0115847351717256,0.00103787684680752;-0.00186763463080292,1.85273807520757e-06,-0.00101002532952898,0.000341285039649959,0.000714345732301617,-0.00211224197691423,0.00155506922361160;0.00234266702275449,-0.00997433986762452,-0.00700992815168033,0.000714345732301617,0.813062453352082,-0.669333055551274,0.464943746158464;0.00698148233960845,0.00287528057223428,0.0115847351717256,-0.00211224197691423,-0.669333055551274,2.10630735785597,0.450871626093646;0.000767642710567363,-0.00543126118860652,0.00103787684680752,0.00155506922361160,0.464943746158464,0.450871626093646,1.53331631668611];

start = [320 0.25 0.15 25 4 15 4];

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_cvm(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_cvm.mat','theta','dist','eps');


end
