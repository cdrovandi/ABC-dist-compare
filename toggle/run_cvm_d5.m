function run_cvm_d5

load('d5.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw(theta_test);
    dist(i) = cvm_stat_M(x,y,2);
end

eps = quantile(dist, 0.01);
%eps = 32.6149999999984;

cov_rw = [0.243460364907311,0.239407963464498,0.147758428856296,-0.0367637617527548,-0.0105905947753849,-0.0522055425685767,0.0338796958384407;0.239407963464498,1.51141198336522,0.404803685761297,-0.0274306325842029,-0.0830403548435687,-0.590608503095885,-0.357472257375999;0.147758428856296,0.404803685761297,0.204037225323420,-0.0222306234853492,-0.0110388216486074,-0.0614598496559718,-0.0124458891402518;-0.0367637617527548,-0.0274306325842029,-0.0222306234853492,0.00606447123420084,0.00151024366535739,-0.00125428984938104,-0.00792134799626445;-0.0105905947753849,-0.0830403548435687,-0.0110388216486074,0.00151024366535739,0.0543196406636941,-0.00446317104042455,0.200130773905172;-0.0522055425685767,-0.590608503095885,-0.0614598496559718,-0.00125428984938104,-0.00446317104042455,2.49462976826828,0.439373169282351;0.0338796958384407,-0.357472257375999,-0.0124458891402518,-0.00792134799626445,0.200130773905172,0.439373169282351,1.35872573136254];

start = theta_test;

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_cvm(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_cvm_d5.mat','theta','dist','eps');


end
