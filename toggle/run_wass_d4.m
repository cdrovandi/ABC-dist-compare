function run_wass_d4

% run abc with Wass distance for dataset 4

load('d4.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw(theta_test);
    dist(i) = Wass_stat_M(x,y,1);
end

eps = quantile(dist, 0.01);
%eps = 2.16793518151315;

start = theta_test;

cov_rw = [0.0134110116476015,-0.00333917236112087,0.000393800585649814,-0.00186078609934278,-0.00175634048916173,0.0211050476088901,-0.0212961058303961;-0.00333917236112087,0.0408979672647017,0.0491112596361756,0.000315399976800087,-0.00186950822286704,0.0265546071628061,-0.0411806302621223;0.000393800585649814,0.0491112596361756,0.0630130553056873,-0.000187723769660233,-0.00313899125385052,0.0262939792461915,-0.0676475223506968;-0.00186078609934278,0.000315399976800087,-0.000187723769660233,0.000272056284690103,0.000334439499881134,-0.00536304901758234,0.00277536647954283;-0.00175634048916173,-0.00186950822286704,-0.00313899125385052,0.000334439499881134,0.00458791301080768,-0.0590994036294870,0.0247284816808589;0.0211050476088901,0.0265546071628061,0.0262939792461915,-0.00536304901758234,-0.0590994036294870,2.90122291952068,0.609963835427608;-0.0212961058303961,-0.0411806302621223,-0.0676475223506968,0.00277536647954283,0.0247284816808589,0.609963835427608,0.975776173027146];

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_wass(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_wass_d4.mat','theta','dist','eps');


end
