function run_cvm_d4

% run abc with CvM distance for dataset 4

load('d4.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw(theta_test);
    dist(i) = cvm_stat_M(x,y,2);
end

eps = quantile(dist, 0.02);
%eps = 32.6149999999984;

cov_rw = [0.00916751588261287,0.00921052064752576,0.0126560263521435,-0.000876044567792487,0.000264739446331559,-0.0509200835444689,-0.00288865668312202;0.00921052064752576,0.0241766071783067,0.0292022009234183,-0.000661858074866674,0.00889137609678318,-0.0828802699347386,0.0377512791048760;0.0126560263521435,0.0292022009234183,0.0368235692745525,-0.000946274535011370,0.0111017037176310,-0.106887224511172,0.0478804632489164;-0.000876044567792487,-0.000661858074866674,-0.000946274535011370,9.64645931548241e-05,0.000238073063224977,0.00403966318982720,0.00125448429059180;0.000264739446331559,0.00889137609678318,0.0111017037176310,0.000238073063224977,0.0187494084331074,-0.0135188938978551,0.0892125932703072;-0.0509200835444689,-0.0828802699347386,-0.106887224511172,0.00403966318982720,-0.0135188938978551,0.673429591854189,0.193740103915685;-0.00288865668312202,0.0377512791048760,0.0478804632489164,0.00125448429059180,0.0892125932703072,0.193740103915685,0.751461680428591];

start = theta_test;

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_cvm(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_cvm_d4.mat','theta','dist','eps');


end
