function run_cvm_d2

% run abc with CvM distance for dataset 2

load('d2.mat')

n = length(y);

% tune the ABC tolerance
for i=1:100000
    x = simulate_tsw(theta_test);
    dist(i) = cvm_stat_M(x,y,2);
end

eps = quantile(dist, 0.01);
%eps = 32.6149999999984;

cov_rw = [0.000589183406221893,0.000440439269797313,0.00222631537665212,-0.000429561138706200,-0.0115056659839721,0.00432000086997876,-0.00515149394498480;0.000440439269797313,0.00387222750809828,0.0331774094361648,-0.00154054354952268,0.00474308747841072,-0.00370371388609036,-0.0261483295349272;0.00222631537665212,0.0331774094361648,1.77263804874383,-0.0675806789744879,-0.109513428045415,-0.248137927025316,-0.437349087272006;-0.000429561138706200,-0.00154054354952268,-0.0675806789744879,0.0155764134639270,-0.0131783544329429,-0.000945138204938228,0.0125861170161296;-0.0115056659839721,0.00474308747841072,-0.109513428045415,-0.0131783544329429,2.50400837847093,-0.100605682920462,0.351989534119330;0.00432000086997876,-0.00370371388609036,-0.248137927025316,-0.000945138204938228,-0.100605682920462,2.47149987282399,0.755769775568799;-0.00515149394498480,-0.0261483295349272,-0.437349087272006,0.0125861170161296,0.351989534119330,0.755769775568799,1.15569284524116];

start = theta_test;

% define prior
prior.num_params = 7;
prior.p1 = [250 0.05 0.05 0 0 0 0];
prior.p2 = [400 0.5 0.35 50 7 50 7];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta) prod(exp(theta)./(1 + exp(theta)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta) [(prior.p2.*exp(theta) + prior.p1)./(1 + exp(theta))];

[theta,dist] = bayes_toggle_abc_cvm(y,n,eps,1e7,cov_rw,prior,start);

save('results_mcmc_cvm_d2.mat','theta','dist','eps');


end
